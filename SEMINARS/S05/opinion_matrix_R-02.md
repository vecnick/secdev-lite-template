# Матрица сравнения вариантов для R-02 - Блокировка аккаунта HH.ru

## 0) Контекст риска (из S04)

* **Risk-ID:** R-02
* **Threat:** D (Denial of Service)
* **DFD element/edge:** Edge: Business Logic → HH.ru API
* **NFR link (ID):** NFR-002
* **L×I (1-5):** L=4, I=4, Score=16
* **Ограничения/предпосылки:** Лимиты HH.ru API (∼200 запросов/день), массовые автоматические отклики

## 1) Критерии и шкалы (1-5)

**Польза (↑):**
- **Security impact (↑):** предотвращение блокировки аккаунта
- **Blast radius reduction (↑):** минимизация влияния на пользователей

**Стоимость/сложность (↓):**
- **Complexity (↓):** сложность реализации
- **Time-to-mitigate (↓):** время до внедрения
- **Dependencies (↓):** внешние зависимости

## 2) Таблица сравнения вариантов

| Alternative | Summary | Security impact (↑,1-5) | Blast radius reduction (↑,1-5) | Complexity (↓,1-5) | Time-to-mitigate (↓,1-5) | Dependencies (↓,1-5) | **Benefit** | **Cost** | **Net** | Notes |
| ----------- | ------- | ----------------------: | -----------------------------: | -----------------: | -----------------------: | -------------------: | ----------: | -------: | ------: | ----- |
| A | Adaptive rate limiting + очередь + мониторинг | 4 | 4 | 3 | 3 | 2 | **8** | **8** | **0** | Баланс безопасности и сложности |
| B | Простой rate limiting (20/мин) | 3 | 3 | 1 | 1 | 1 | **6** | **3** | **+3** | Просто, но может не учитывать все лимиты |
| C | Полная очередь + отложенная обработка | 5 | 5 | 5 | 4 | 3 | **10** | **12** | **-2** | Максимальная защита, но сложно |

## 3) Тай-брейкеры при равенстве Net

* **Compliance/Privacy:** не применимо
* **Maintainability:** adaptive limiting проще в обслуживании чем полная очередь
* **Team fit:** есть опыт с Redis-based rate limiting
* **Observability:** adaptive limiting предоставляет лучшие метрики
* **Rollback safety:** можно переключиться на простой limiting

## 4) Решение (для переноса в ADR)

* **Chosen alternative:** A
* **Почему:** Adaptive rate limiting обеспечивает хорошую защиту от превышения лимитов при умеренной сложности. Позволяет динамически адаптироваться к изменениям в политиках HH.ru.
* **ADR candidate:** "Adaptive HH.ru API Rate Limiting"
* **Связки:** Risk-ID R-02, NFR-ID NFR-002, DFD Edge Business Logic→HH.ru API
* **Следующие шаги:**
  1. Реализовать adaptive rate limiting на основе ответов HH.ru API
  2. Настроить очередь для отложенной обработки при превышении лимитов
  3. Добавить мониторинг использования квот
  4. Реализовать уведомления о приближении к лимитам
