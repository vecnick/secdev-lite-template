# Матрица сравнения вариантов для R-03 - Доступ к PII данным

## 0) Контекст риска (из S04)

* **Risk-ID:** R-03
* **Threat:** I (Information Disclosure)
* **DFD element/edge:** Node: PostgreSQL
* **NFR link (ID):** NFR-006
* **L×I (1-5):** L=3, I=5, Score=15
* **Ограничения/предпосылки:** Хранение резюме, контактов, истории откликов - чувствительные PII данные

## 1) Критерии и шкалы (1-5)

**Польза (↑):**
- **Security impact (↑):** защита конфиденциальности данных
- **Blast radius reduction (↑):** ограничение ущерба при утечке

**Стоимость/сложность (↓):**
- **Complexity (↓):** сложность реализации
- **Time-to-mitigate (↓):** время до внедрения
- **Dependencies (↓):** внешние зависимости

## 2) Таблица сравнения вариантов

| Alternative | Summary | Security impact (↑,1-5) | Blast radius reduction (↑,1-5) | Complexity (↓,1-5) | Time-to-mitigate (↓,1-5) | Dependencies (↓,1-5) | **Benefit** | **Cost** | **Net** | Notes |
| ----------- | ------- | ----------------------: | -----------------------------: | -----------------: | -----------------------: | -------------------: | ----------: | -------: | ------: | ----- |
| A | Шифрование на уровне БД + ключи в KMS | 5 | 5 | 4 | 4 | 3 | **10** | **11** | **-1** | Максимальная защита, умеренная сложность |
| B | Шифрование на уровне приложения | 4 | 4 | 3 | 3 | 2 | **8** | **8** | **0** | Хорошая защита, проще реализация |
| C | Маскирование в логах + базовые права | 3 | 3 | 2 | 2 | 1 | **6** | **5** | **+1** | Минимальная защита, быстро |

## 3) Тай-брейкеры при равенстве Net

* **Compliance/Privacy:** шифрование на уровне БД лучше соответствует GDPR
* **Maintainability:** шифрование на уровне приложения проще сопровождать
* **Team fit:** есть опыт работы с шифрованием в приложении
* **Observability:** сложнее дебажить с шифрованием на уровне БД
* **Rollback safety:** шифрование на уровне приложения проще откатить

## 4) Решение (для переноса в ADR)

* **Chosen alternative:** B
* **Почему:** Шифрование на уровне приложения обеспечивает хороший баланс между безопасностью и сложностью. Позволяет контролировать процессы шифрования/дешифрования и проще в отладке.
* **ADR candidate:** "Application-Level PII Encryption"
* **Связки:** Risk-ID R-03, NFR-ID NFR-006, DFD Node PostgreSQL
* **Следующие шаги:**
  1. Определить поля PII для шифрования (имя, email, телефоны, резюме)
  2. Реализовать сервис шифрования с использованием AES-256
  3. Интегрировать ключи из HashiCorp Vault или AWS KMS
  4. Настроить маскирование PII в логах и ответах API
