# Матрица сравнения вариантов для R-05 - Обход проверок прав доступа

## 0) Контекст риска (из S04)

* **Risk-ID:** R-05
* **Threat:** E (Elevation of Privilege)
* **DFD element/edge:** Node: Business Logic
* **NFR link (ID):** need NFR
* **L×I (1-5):** L=3, I=4, Score=12
* **Ограничения/предпосылки:** Сложная бизнес-логика управления откликами и сообщениями, требуется строгая изоляция данных пользователей

## 1) Критерии и шкалы (1-5)

**Польза (↑):**
- **Security impact (↑):** предотвращение несанкционированного доступа к данным
- **Blast radius reduction (↑):** ограничение ущерба при компрометации

**Стоимость/сложность (↓):**
- **Complexity (↓):** сложность реализации
- **Time-to-mitigate (↓):** время до внедрения
- **Dependencies (↓):** внешние зависимости

## 2) Таблица сравнения вариантов

| Alternative | Summary | Security impact (↑,1-5) | Blast radius reduction (↑,1-5) | Complexity (↓,1-5) | Time-to-mitigate (↓,1-5) | Dependencies (↓,1-5) | **Benefit** | **Cost** | **Net** | Notes |
| ----------- | ------- | ----------------------: | -----------------------------: | -----------------: | -----------------------: | -------------------: | ----------: | -------: | ------: | ----- |
| A | Strict RBAC + проверка владения на каждом слое | 5 | 5 | 4 | 4 | 3 | **10** | **11** | **-1** | Максимальная безопасность, требует дисциплины |
| B | RBAC на уровне контроллера + базовые проверки | 4 | 4 | 3 | 3 | 2 | **8** | **8** | **0** | Хорошая защита, умеренная сложность |
| C | Базовые проверки в сервисном слое | 3 | 3 | 2 | 2 | 1 | **6** | **5** | **+1** | Минимальная защита, быстро |

## 3) Тай-брейкеры при равенстве Net

* **Compliance/Privacy:** strict RBAC лучше соответствует требованиям защиты данных
* **Maintainability:** RBAC на уровне контроллера проще сопровождать
* **Team fit:** есть опыт с Spring Security и RBAC
* **Observability:** strict RBAC предоставляет лучший аудит доступа
* **Rollback safety:** можно постепенно внедрять с feature flags

## 4) Решение (для переноса в ADR)

* **Chosen alternative:** A
* **Почему:** Strict RBAC с проверками на каждом слое обеспечивает максимальную защиту от обхода прав доступа. Соответствует принципу "defense in depth".
* **ADR candidate:** "Strict RBAC Implementation"
* **Связки:** Risk-ID R-05, DFD Node Business Logic
* **Следующие шаги:**
  1. Определить роли и permissions для всех операций
  2. Реализовать проверки владения ресурсом на DAO уровне
  3. Добавить аннотации безопасности в контроллерах
  4. Реализовать централизованную обработку ошибок доступа
