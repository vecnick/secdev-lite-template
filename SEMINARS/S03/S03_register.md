# Реестр NFR для системы автоматизации поиска работы

## Таблица реестра нефункциональных требований

| ID | User Story / Feature | Category | Requirement (NFR) | Rationale / Risk | Acceptance (G-W-T) | Evidence (test/log/scan/policy) | Trace (issue/link) | Owner | Status | Priority | Severity | Tags |
|----|---------------------|----------|-------------------|------------------|-------------------|--------------------------------|-------------------|-------|--------|----------|----------|------|
| NFR-001 | US-005: Массовая отправка откликов | Performance | P95 латентность для `/api/hh/auto-apply` ≤ 3000 ms при обработке 100+ вакансий | UX при массовых операциях, соблюдение лимитов HH.ru API | **Given** сервис развернут и HH.ru API доступен<br>**When** отправляется запрос на обработку 100+ вакансий<br>**Then** P95 времени ответа ≤ 3000 ms и доля ошибок ≤ 1% | test: `load-auto-apply`; metric: `http_server_requests_seconds` | #perf-001 | backend-team | Draft | P1 - High | S2 - Major | performance,api |
| NFR-002 | US-005: Массовая отправка откликов | RateLimiting | Лимит 20 откликов/минута на пользователя для HH.ru API | Обход лимитов HH.ru API, защита от бана аккаунта | **Given** активный пользователь с валидным токеном<br>**When** отправляется 21+ отклик за 60 секунд<br>**Then** лишние запросы получают 429 с заголовком Retry-After | test: `rate-limit-hh`; log: throttling events | #rate-001 | backend-team | Draft | P1 - High | S1 - Critical | ratelimiting,api |
| NFR-003 | US-004: Генерация сопроводительных писем ИИ | Performance | Генерация письма через Ollama ≤ 5000 ms | UX при создании персонализированных писем | **Given** валидные данные вакансии и резюме<br>**When** вызывается `/api/ai/generate-cover-letter`<br>**Then** время ответа ≤ 5000 ms и возвращается валидный текст письма | test: `ai-generation-time`; metric: response time | #ai-001 | ai-team | Draft | P2 - Medium | S2 - Major | ai,performance |
| NFR-004 | US-008: Настройка уведомлений в Telegram | Performance | Доставка уведомлений в Telegram ≤ 1000 ms | Своевременное информирование пользователя о важных событиях | **Given** новое сообщение от рекрутера или системное событие<br>**When** система отправляет уведомление через Telegram Bot API<br>**Then** уведомление доставляется ≤ 1000 ms | test: `telegram-notification-delay`; log: delivery confirmation | #notif-001 | backend-team | Draft | P2 - Medium | S2 - Major | notifications,performance |
| NFR-005 | US-001: Авторизация через HH.ru OAuth | Security-AuthN | OAuth 2.0 авторизация через HH.ru с валидацией токена | Безопасный доступ к API HH.ru, защита пользовательских данных | **Given** пользователь проходит OAuth-авторизацию<br>**When** токен истекает или невалиден<br>**Then** система возвращает 401 и запрашивает повторную авторизацию | test: `oauth-validation`; scan: security headers | #auth-001 | security-team | R-01, ADR-001 | P1 - High | S1 - Critical | security,authentication |
| NFR-006 | US-002: Настройка профиля и резюме | Privacy/PII | Шифрование PII данных в PostgreSQL (AES-256) | Защита персональных данных пользователей согласно GDPR | **Given** данные пользователя содержат PII (имя, контакты, резюме)<br>**When** выполняется запись в БД<br>**Then** PII поля зашифрованы и не читаемы без ключа | scan: db-encryption; policy: data encryption standard | #security-001 | security-team | R-03, ADR-003 | P1 - High | S1 - Critical | privacy,encryption |
| NFR-007 | US-009: Просмотр аналитики и отчетов | Auditability | Логирование всех операций с откликами и сообщениями | Аудит действий для анализа эффективности и расследования инцидентов | **Given** любое действие пользователя (отклик, генерация письма, ответ)<br>**When** операция выполняется<br>**Then** создается audit-запись с timestamp, user_id, action_type, result, target_id | test: `audit-logging`; log: audit entries with correlation_id | #audit-001 | backend-team | Draft | P2 - Medium | S3 - Minor | auditing,logging |
| NFR-008 | US-003: Поиск вакансий с фильтрами | Timeouts/Retry/CircuitBreaker | Timeout 10s для HH.ru API, 3 retry с exponential backoff | Устойчивость к сбоям внешнего API, минимизация простоев | **Given** HH.ru API недоступен или отвечает с задержкой<br>**When** сервис вызывает API поиска вакансий<br>**Then** выполняются 3 retry с backoff, затем circuit breaker открывается на 30s | test: `circuit-breaker-hh`; log: retry attempts and breaker state | #resilience-001 | backend-team | Draft | P2 - Medium | S2 - Major | resilience,api |
| NFR-009, R-04, ADR-002 | US-002: Настройка профиля и резюме | Security-InputValidation | Валидация JSON-схем для всех входящих запросов профиля | Защита от инъекций и некорректных данных | **Given** запрос с невалидным JSON или лишними полями к `/api/users`<br>**When** обрабатывается сервером<br>**Then** возвращается 400 с детальным описанием ошибки в формате RFC 7807 | test: `json-validation`; policy: input schema validation | #security-002 | backend-team | Draft | P2 - Medium | S2 - Major | validation,security |
| NFR-010 | US-009: Просмотр аналитики и отчетов | Performance | Генерация PDF отчета ≤ 10000 ms для 1000+ записей | UX при работе с аналитикой, обработка больших объемов данных | **Given** 1000+ записей истории откликов в БД<br>**When** запрашивается PDF отчет через `/api/analytics/reports`<br>**Then** отчет генерируется ≤ 10000 ms | test: `report-generation`; metric: generation time for large datasets | #analytics-001 | backend-team | Draft | P3 - Low | S3 - Minor | analytics,performance |
| **NFR-011** | US-003: Поиск вакансий с фильтрами | Resilience | Circuit breaker активируется при 50% ошибок за 1 минуту, timeout 10s | Устойчивость к сбоям внешних API, минимизация простоев | **Given** HH.ru API недоступен<br>**When** сервис вызывает API поиска вакансий<br>**Then** circuit breaker открывается после 3 неудачных попыток | test: `circuit-breaker-test`; metric: breaker state changes | R-04, ADR-002 | backend-team | Draft | P2 - Medium | S2 - Major | resilience,circuit-breaker |
| **NFR-012** | US-002: Настройка профиля и резюме | Security-AuthZ/RBAC | Strict RBAC с проверками владения на Controller, Service и DAO уровнях | Защита от несанкционированного доступа к данным других пользователей | **Given** пользователь A пытается получить доступ к данным пользователя B<br>**When** выполняется запрос через любой слой приложения<br>**Then** возвращается 404 без утечки информации | test: `rbac-penetration-test`; log: access denied events | R-05, ADR-003 | security-team | Draft | P1 - High | S2 - Major | security,rbac,access-control |
| **NFR-013** | US-006: Мониторинг сообщений от рекрутеров | Observability/Logging | Все критические операции содержат correlation_id в логах | Трассировка операций для разбора инцидентов | **Given** запрос с X-Correlation-ID<br>**When** операция проходит через систему<br>**Then** все логи содержат correlation_id | test: `correlation-id-test`; log: pattern validation | T03, T05 | backend-team | Draft | P2 - Medium | S3 - Minor | observability,logging |

